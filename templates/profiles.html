{% extends 'layout.html' %}
{% block content %}

<!-- Hidden form for delete confirmation -->
<form id="deleteForm" method="POST" style="display: none;"></form>

<div class="content gymnast-profile-page">
    <!-- Enhanced Page Header -->
    <div class="profile-hero">
        <div class="hero-background">
            <div class="hero-pattern"></div>
        </div>
        <div class="hero-content">
            <div class="navigation">
                {% if current_user.is_admin %}
                <a href="{{ url_for('main.gymnasts') }}" class="back-btn">
                    <i class="nav-icon">←</i>
                    <span>Back to Gymnasts</span>
                </a>
                {% else %}
                <a href="{{ url_for('main.topnz') }}" class="back-btn">
                    <i class="nav-icon">←</i>
                    <span>Back to Rankings</span>
                </a>
                {% endif %}
            </div>
            <div class="gymnast-showcase">
                <div class="gymnast-avatar">
                    <div class="avatar-circle">
                        <span class="avatar-initials">{{ gymnast.name.split()[0][0] }}{{ gymnast.name.split()[-1][0] if
                            gymnast.name.split()|length > 1 else '' }}</span>
                    </div>
                </div>
                <div class="gymnast-info">
                    <h1 class="gymnast-name">{{ gymnast.name }}</h1>
                    <div class="gymnast-badges">
                        <span class="level-badge">
                            <i class="badge-icon"></i>
                            Level {{ gymnast.level }}
                        </span>
                        <span class="club-badge">
                            <i class="badge-icon"></i>
                            {{ gymnast.clubs.name }}
                        </span>
                        {% if gymnast.age %}
                        <span class="age-badge">
                            <i class="badge-icon"></i>
                            Age {{ gymnast.age }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="gymnast-subtitle">Gymnast Profile</div>
                </div>
            </div>

            <!-- Admin Actions - Positioned in bottom right -->
            {% if current_user.is_authenticated %}
            {% if current_user.is_admin %}
            <div class="admin-actions-corner">
                <a href="{{ url_for('main.admin_edit_gymnast_bio', gymnast_id=gymnast.id) }}"
                    class="admin-btn admin-btn-primary">
                    Edit Bio
                </a>
                <button onclick="deleteGymnast({{ gymnast.id }}, '{{ gymnast.name }}')"
                    class="admin-btn admin-btn-danger">
                    Delete
                </button>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>

    <!-- Bio Information -->
    <div class="bio-section">
        <div class="bio-grid">
            <!-- Personal Information -->
            <div class="bio-card">
                <h3>Personal Information</h3>
                <div class="bio-content">
                    <div class="bio-item">
                        <span class="bio-label">Age:</span>
                        <span class="bio-value">{{ gymnast.age if gymnast.age else 'Not specified' }}</span>
                    </div>
                    <div class="bio-item">
                        <span class="bio-label">Club:</span>
                        <span class="bio-value">{{ gymnast.clubs.name }}</span>
                    </div>
                    <div class="bio-item">
                        <span class="bio-label">Level:</span>
                        <span class="bio-value">{{ gymnast.level }}</span>
                    </div>
                </div>
            </div>

            <!-- Goals -->
            <div class="bio-card">
                <h3>Goals</h3>
                <div class="bio-content">
                    {% if gymnast.goals %}
                    <p class="goals-text">{{ gymnast.goals }}</p>
                    {% else %}
                    <p class="no-data-text">Goals not yet specified</p>
                    {% endif %}
                </div>
            </div>

            <!-- Achievements -->
            <div class="bio-card">
                <h3>Achievements</h3>
                <div class="bio-content">
                    {% if gymnast.achievements %}
                    <div class="achievements-text">{{ gymnast.achievements|safe }}</div>
                    {% else %}
                    <p class="no-data-text">Achievements will be listed here</p>
                    {% endif %}
                </div>
            </div>

            <!-- Injury History -->
            <div class="bio-card">
                <h3>Injury History</h3>
                <div class="bio-content">
                    {% if gymnast.injuries %}
                    <div class="injury-history">
                        <span class="status-indicator history"></span>
                        <div class="injury-text">{{ gymnast.injuries|replace('\n', '<br>')|safe }}</div>
                    </div>
                    {% else %}
                    <div class="injury-status">
                        <span class="status-indicator clean"></span>
                        <span class="status-text">No injury history recorded</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- All-Around Total -->
    {% if all_around_data %}
    <div class="stats-overview">
        <div class="stat-card">
            <h3>All-Around Best</h3>
            <div class="stat-value">{{ "%.3f"|format(all_around_data[0].total_score) }}</div>
        </div>
    </div>
    {% endif %}

    <!-- Best Scores by Apparatus -->
    {% if apparatus_data %}
    <div class="section">
        <h2>Personal Best Scores</h2>
        <div class="best-scores-grid">
            {% for apparatus_name, apparatus_scores in apparatus_data.items() %}
            {% if apparatus_scores %}
            <div class="apparatus-card">
                <h3>{{ apparatus_name }}</h3>
                <div class="score-details">
                    <div class="main-score">{{ "%.3f"|format(apparatus_scores[0].total) }}</div>
                    <div class="score-breakdown">
                        <span>E: {{ "%.3f"|format(apparatus_scores[0].e_score) }}</span>
                        <span>D: {{ "%.3f"|format(apparatus_scores[0].d_score) }}</span>
                        <span>P: {{ "%.3f"|format(apparatus_scores[0].penalty) }}</span>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- No Data Message -->
    {% if not apparatus_data and not all_around_data %}
    <div class="no-data">
        <h2>No Competition Data</h2>
        <p>This gymnast hasn't competed yet or their scores haven't been recorded.</p>
    </div>
    {% endif %}
</div>

<!-- Admin buttons moved to header for better visibility -->

{% endblock %}

<script>
    // Delete function
    function deleteGymnast(id, name) {
        if (confirm(`Are you sure you want to delete ${name}? This action cannot be undone.`)) {
            const form = document.getElementById('deleteForm');
            form.action = `/delete_gymnast/${id}`;
            form.submit();
        }
    }

    // Simplified FAB - no toggle needed, buttons are always visible
</script>