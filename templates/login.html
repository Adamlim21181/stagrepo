{% extends 'layout.html' %}
{% block title %}Login - SMART{% endblock %}
{% block content %}

<div class="auth-page login-page">
    <div class="auth-container">
        <!-- Header Section -->
        <div class="auth-header">
            <div class="auth-logo">
                <div class="logo-circle">
                    <span class="logo-text">SG</span>
                </div>
            </div>
            <h1>Welcome Back</h1>
            <p class="auth-subtitle">Sign in to your STAG gymnastics account</p>
        </div>

        <!-- Login Form -->
        <form method="POST" class="auth-form login-form" id="loginForm">
            {{ form.hidden_tag() }}

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                <div class="flash-message flash-{{ category }}">
                    <span class="flash-icon">
                        {% if category == 'error' %}!{% elif category == 'success' %}{% else %}i{% endif %}
                    </span>
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <!-- Login Fields Section -->
            <div class="form-section">
                <h3 class="section-title">
                    <span class="section-icon">üîê</span>
                    Account Access
                </h3>

                <div class="form-group">
                    {{ form.email.label(class="form-label") }}
                    {{ form.email(class="form-control", type="email", placeholder="Enter your email address") }}
                    {% if form.email.errors %}
                    <div class="field-errors">
                        {% for error in form.email.errors %}
                        <span class="error-message">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.password.label(class="form-label") }}
                    <div class="password-field">
                        {{ form.password(class="form-control", id="password", placeholder="Enter your password") }}
                        <button type="button" class="password-toggle" onclick="togglePassword('password')">
                            <span class="eye-icon">üëÅ</span>
                        </button>
                    </div>
                    {% if form.password.errors %}
                    <div class="field-errors">
                        {% for error in form.password.errors %}
                        <span class="error-message">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

            </div>

            <!-- Submit Button -->
            <div class="form-actions">
                {{ form.submit(class="submit-btn primary-btn") }}
            </div>

            <!-- Additional Links -->
            <div class="auth-links">
                <p class="link-text">
                    Don't have an account?
                    <a href="{{ url_for('main.register') }}" class="auth-link">Sign up here</a>
                </p>
                <p class="link-text">
                    <a href="#" class="auth-link forgot-link">Forgot your password?</a>
                </p>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript for Enhanced UX -->
<script>
    function togglePassword(fieldId) {
        const passwordField = document.getElementById(fieldId);
        const eyeIcon = event.target.closest('.password-toggle').querySelector('.eye-icon');

        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            eyeIcon.textContent = 'üôà';
        } else {
            passwordField.type = 'password';
            eyeIcon.textContent = 'show';
        }
    }

    function showLoading(button) {
        button.textContent = 'Signing in...';
        button.disabled = true;

        // Re-enable after 3 seconds in case of form validation errors
        setTimeout(() => {
            button.textContent = 'Sign In';
            button.disabled = false;
        }, 3000);
    }

    // Form validation feedback and submit handling
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('loginForm');
        const submitBtn = form.querySelector('.submit-btn');
        const inputs = form.querySelectorAll('input[type="text"], input[type="email"], input[type="password"]');

        // Handle form submission
        form.addEventListener('submit', function (e) {
            if (submitBtn) {
                submitBtn.textContent = 'Signing in...';
                submitBtn.disabled = true;
            }
        });

        inputs.forEach(input => {
            input.addEventListener('blur', function () {
                if (this.value.trim() === '') {
                    this.classList.add('error');
                } else {
                    this.classList.remove('error');
                }
            });

            input.addEventListener('input', function () {
                this.classList.remove('error');
            });
        });
    });
</script>

{% endblock %}