{% extends 'layout.html' %}
{% block content %}

<div class="entries-page">
    <div class="content">
        <h1>Competition Entries Management</h1>

        <!-- Add New Entry Form -->
        <div class="add-entry">
            <h2>Add Gymnast to Competition</h2>
            <form method="POST">
                <div class="form-row">
                    <div class="form-group">
                        <label for="competition_id">Competition:</label>
                        <select id="competition_id" name="competition_id" required>
                            <option value="">Select Competition...</option>
                            {% for competition in competitions %}
                            <option value="{{ competition.id }}">{{ competition.name }} - {{
                                competition.competition_date }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="gymnast_search">Search Gymnast:</label>
                        <input type="text" id="gymnast_search"
                            placeholder="Type to search gymnasts by name, club, or level..." autocomplete="off">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="gymnast_id">Gymnast:</label>
                        <select id="gymnast_id" name="gymnast_id" required>
                            <option value="">Select Gymnast...</option>
                            {% for gymnast in gymnasts %}
                            <option value="{{ gymnast.id }}" data-name="{{ gymnast.name|lower }}"
                                data-club="{{ gymnast.clubs.name|lower }}" data-level="{{ gymnast.level|lower }}">
                                #{{ "%03d"|format(gymnast.id) }} - {{ gymnast.name }} - {{ gymnast.clubs.name }} ({{
                                gymnast.level }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Add Entry</button>
                </div>
            </form>
        </div>

        <!-- Existing Entries List -->
        <div class="entries-list">
            <h2>Current Entries</h2>
            <table>
                <thead>
                    <tr>
                        <th>Competition</th>
                        <th>Gymnast ID</th>
                        <th>Gymnast Name</th>
                        <th>Club</th>
                        <th>Level</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry, competition, gymnast, club in entries %}
                    <tr>
                        <td>{{ competition.name }}</td>
                        <td>#{{ "%03d"|format(gymnast.id) }}</td>
                        <td>{{ gymnast.name }}</td>
                        <td>{{ club.name }}</td>
                        <td>{{ gymnast.level }}</td>
                        <td>
                            <a href="#" class="btn btn-danger btn-sm">Remove</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Simple search functionality for gymnast dropdown
    document.getElementById('gymnast_search').addEventListener('input', function () {
        const searchTerm = this.value.toLowerCase();
        const select = document.getElementById('gymnast_id');
        const options = select.getElementsByTagName('option');

        for (let i = 1; i < options.length; i++) { // Skip first empty option
            const option = options[i];
            const name = option.getAttribute('data-name') || '';
            const club = option.getAttribute('data-club') || '';
            const level = option.getAttribute('data-level') || '';
            const text = option.textContent.toLowerCase();

            if (text.includes(searchTerm) || name.includes(searchTerm) ||
                club.includes(searchTerm) || level.includes(searchTerm)) {
                option.style.display = '';
            } else {
                option.style.display = 'none';
            }
        }

        // If there's a search term and only one visible option, auto-select it
        const visibleOptions = Array.from(options).filter(opt => opt.style.display !== 'none' && opt.value !== '');
        if (searchTerm && visibleOptions.length === 1) {
            select.value = visibleOptions[0].value;
        }
    });

    // Clear search when gymnast is manually selected
    document.getElementById('gymnast_id').addEventListener('change', function () {
        if (this.value) {
            document.getElementById('gymnast_search').value = '';
        }
    });
</script>

<style>
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }

    .form-group {
        flex: 1;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: var(--text-secondary);
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: var(--primary-green);
        box-shadow: 0 0 0 2px rgba(101, 163, 13, 0.2);
    }

    .form-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        display: inline-block;
    }

    .btn-primary {
        background-color: var(--primary-green);
        color: white;
    }

    .btn-primary:hover {
        background-color: var(--primary-green-dark);
    }

    .btn-danger {
        background-color: #dc3545;
        color: white;
    }

    .btn-sm {
        padding: 4px 8px;
        font-size: 12px;
    }

    .add-entry {
        background-color: var(--background-section);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .entries-list {
        background-color: var(--background-section);
        padding: 20px;
        border-radius: 8px;
    }

    .entries-list table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    .entries-list th,
    .entries-list td {
        padding: 12px 8px;
        text-align: left;
        border-bottom: 1px solid var(--border-light);
    }

    .entries-list th {
        background-color: var(--background-light);
        font-weight: 600;
        color: var(--text-secondary);
    }

    .entries-list tr:hover {
        background-color: #f8f9fa;
    }

    #gymnast_search {
        background-color: #f8f9fa;
        border: 2px dashed #dee2e6;
    }

    #gymnast_search:focus {
        background-color: white;
        border-style: solid;
    }
</style>

{% endblock %}